# Secure Credentials Setup Guide

## Overview
Your Google Client ID and Secret are now stored using multi-layer encryption to make extraction from the APK significantly more difficult.

## Security Features Implemented

### 1. **Multi-Layer Encryption**
- XOR encryption with rotating keys
- Split key storage (scattered across multiple byte arrays)
- Position-dependent encryption (different encryption per byte position)
- Key rotation based on byte index

### 2. **Obfuscation Techniques**
- Keys split into multiple parts (Part1, Part2, Part3)
- Additional XOR pattern applied to reconstructed key
- No plain text credentials in code
- Editor-only encryption generation

### 3. **Build-Time Protection**
- Editor uses environment variables (not compiled into build)
- Production builds use encrypted byte arrays only
- Credentials never stored as plain strings in compiled code

## Setup Instructions

### Step 1: Generate Encrypted Credentials

1. Open Unity Editor
2. Go to **Window → Secure Credentials → Generate Encrypted Credentials**
3. Enter your Google Client ID and Client Secret
4. Click **Generate Encrypted Values**
5. Check the Console - you'll see two byte arrays printed

### Step 2: Update SecureCredentials.cs

1. Open `Assets/Scripts/Network/SecureCredentials.cs`
2. Find the `GetClientId()` method
3. Replace the empty `encryptedId` byte array with your generated Client ID bytes
4. Find the `GetClientSecret()` method
5. Replace the empty `encryptedSecret` byte array with your generated Client Secret bytes
6. Save the file

Example:
```csharp
byte[] encryptedId = {
    0xA3, 0x5F, 0x8B, 0x12, 0x45, 0x9E, 0xCC, 0x71,
    // ... paste your generated bytes here
};
```

### Step 3: Clear Your Credentials

1. Go back to the Secure Credentials window
2. Click **Clear Values**
3. Close the window
4. **IMPORTANT**: Clear the Console to remove logged values

### Step 4: Additional Security (Optional)

For extra security, modify the encryption keys in `SecureCredentials.cs`:

1. Change the values in `Part1`, `Part2`, `Part3` arrays
2. Change the values in `XorPattern` array
3. Re-generate your encrypted credentials with the new keys

## Development vs Production

### Development (Unity Editor)
- Uses environment variables if available
- Falls back to empty string if not configured
- No encrypted values needed during development

To set environment variables:
```powershell
# Windows PowerShell
[System.Environment]::SetEnvironmentVariable('GOOGLE_CLIENT_ID', 'your-id', 'User')
[System.Environment]::SetEnvironmentVariable('GOOGLE_CLIENT_SECRET', 'your-secret', 'User')
```

### Production (Build)
- Uses encrypted byte arrays only
- No environment variables accessed
- Credentials decrypted at runtime

## Security Considerations

### What This Protects Against
✅ Casual APK inspection
✅ Simple string searches with tools like `strings` command
✅ Basic decompilation and code reading
✅ Static analysis tools

### What This DOESN'T Fully Protect Against
❌ Determined attackers with time and tools
❌ Runtime memory inspection while app is running
❌ Advanced reverse engineering

### Best Practice
For maximum security, use **server-side token exchange** as shown in Google's documentation:
https://developer.android.com/games/pgs/android/server-access

The current implementation is a **reasonable compromise** when server-side exchange isn't feasible, making credential extraction significantly harder without requiring a backend server.

## Troubleshooting

### "Client ID not configured!" Error
- You haven't generated and pasted the encrypted credentials yet
- Follow Steps 1-2 above

### "Decryption failed" Error
- The encryption keys were changed after generating credentials
- Re-generate credentials with current keys

### Empty credentials in editor
- Set environment variables as shown above
- Or temporarily hardcode values in editor-only code section

## Important Notes

1. **Never commit plain text credentials to version control**
2. **Clear the Unity Console after generating credentials**
3. **Close the Secure Credentials window after use**
4. **Consider rotating your credentials periodically**
5. **This is defense-in-depth, not absolute protection**

## Next Steps

After setup:
1. Test authentication in editor with environment variables
2. Build for Android and test on device
3. Monitor for any authentication errors
4. Consider implementing server-side token exchange for production
